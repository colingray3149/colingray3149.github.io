(()=>{const m=document.getElementById("runner-canvas"),t=m.getContext("2d",{alpha:!1});let h=1,c=1;const F=()=>{const e=Math.max(1,Math.min(2,window.devicePixelRatio||1));m.width=Math.floor(innerWidth*e),m.height=Math.floor(innerHeight*e),h=m.width/innerWidth,c=m.height/innerHeight};window.addEventListener("resize",F,{passive:!0});const d={sky:"#0a0b0f",road:"#232838",roadLine:"#5ae0ff",star:"#5ae0ff",neonGreen:"#78ff8a",neonPink:"#ff37a6",neonBlue:"#5ae0ff",tire:"#111",rim:"#aaa",headlight:"#ffe36a"};let E="ready",x=0,w=1;const Y=8;let b=Y*h,u=1,A=0,S=[],y=[];const f={left:!1,right:!1},_=()=>m.height,g=()=>m.width,T=60*c,ie=-12*c,L=()=>_()-T+ie,le=.55*c,ae=-14.5*c,se=.4,ce=20*c,o={x:()=>g()*.18,y:0,w:88*h,h:22*c,vy:0,grounded:!0,ducking:!1,duckLerp:0,hitbox(){const e=this.h*.5*(1-.4*this.duckLerp),n=e*.9*(1-.4*this.duckLerp),a=e+n,i=this.y-n;return{x:this.x(),y:i,w:this.w*.9,h:a}}},U={stars:[]},re=document.getElementById("score"),de=document.getElementById("game-over-screen"),fe=document.getElementById("final-score"),G=document.getElementById("countdown-message");function z(e,n,a,i,l,s){for(let p=0;p<a;p++)S.push({x:e,y:n,vx:(Math.random()-.5)*s,vy:(Math.random()-.5)*s,life:Math.random()*l,color:i,size:Math.random()*3+1})}function he(){for(let e=S.length-1;e>=0;e--){const n=S[e];n.x+=n.vx,n.y+=n.vy,n.life-=.05,n.life<=0?S.splice(e,1):(t.globalAlpha=n.life,t.fillStyle=n.color,t.fillRect(n.x,n.y,n.size,n.size))}t.globalAlpha=1}const ue=e=>{const n=o.x(),a=o.y,i=o.w,l=o.h,s=l*.5,p=i*.02,v=s*.9,M=i*.47,R=i*.28,B=i*.1,be=i*.08,Ae=s*1.1,$=i*.18,j=i*.05,_e=i*.05,Q=s*(1-.4*e),Ie=v*(1-.4*e),Z=Ae*(1-.4*e),ee=i*(.2+.15*e),r=a,P=a+Q,k=l*.5,C=P,V=t.createLinearGradient(n,r,n,P);V.addColorStop(0,"#47ff7a"),V.addColorStop(1,"#20c85b"),t.fillStyle=d.tire,t.beginPath(),t.arc(n+i*.24,C,k,0,Math.PI*2),t.arc(n+i*.76,C,k,0,Math.PI*2),t.fill(),t.fillStyle=d.rim,t.beginPath(),t.arc(n+i*.24,C,k*.4,0,Math.PI*2),t.arc(n+i*.76,C,k*.4,0,Math.PI*2),t.fill(),t.fillStyle=V,t.beginPath(),t.moveTo(n+p,r),t.lineTo(n+i-ee,r),t.lineTo(n+i,P),t.lineTo(n,P),t.closePath(),t.fill();const te=r-Ie,W=n+R,ne=W+M,Me=W+B,Re=ne-be;t.beginPath(),t.moveTo(W,r),t.lineTo(Me,te),t.lineTo(Re,te),t.lineTo(ne,r),t.fill();const H=n+_e;t.beginPath(),t.moveTo(H,r),t.lineTo(H-j,r-Z),t.lineTo(H-j-$,r-Z),t.lineTo(H-$,r),t.closePath(),t.fill(),t.fillStyle=d.headlight;const oe=i*.08,X=l*.25,O=n+i-ee,D=r+Q*.1;t.beginPath(),t.moveTo(O,D),t.lineTo(O-oe,D+X*.2),t.lineTo(O-oe,D+X),t.lineTo(O,D+X),t.closePath(),t.fill()};function ye(e){if(e.type==="car"){const n=t.createLinearGradient(e.x,e.y,e.x+e.w,e.y);n.addColorStop(0,d.neonPink),n.addColorStop(1,d.neonBlue),t.fillStyle=n,t.fillRect(e.x,e.y,e.w,e.h),t.fillRect(e.x+e.w*.5,e.y-e.h*.35,e.w*.4,e.h*.35)}else{const n=e.x+e.w,a=e.y+e.h/2,i=e.w*.6;for(let l=0;l<5;l++){const s=Math.random(),p=(1-s)*8*c+2,v=n+s*i*(.5+Math.random()*.5),M=a+(Math.random()-.5)*e.h*.9;s>.6?t.fillStyle="rgba(255, 230, 100, 0.8)":s>.3?t.fillStyle="rgba(255, 140, 0, 0.9)":t.fillStyle="rgba(255, 60, 0, 1)",t.beginPath(),t.arc(v,M,p,0,Math.PI*2),t.fill()}t.fillStyle="#cfd7ff",t.fillRect(e.x,e.y,e.w,e.h),t.fillRect(e.x+e.w*.15,e.y+e.h*.35,e.w*.7,e.h*.22),t.fillRect(e.x-e.w*.08,e.y+e.h*.15,e.w*.08,e.h*.7)}}function ge(){t.fillStyle=d.sky,t.fillRect(0,0,g(),_()),t.globalAlpha=.7,t.fillStyle=d.star;for(const e of U.stars)e.x-=.1,e.x<0&&(e.x=g()),t.fillRect(e.x,e.y,e.s,e.s);t.globalAlpha=1}function pe(){const e=_()-T;t.fillStyle=d.road,t.fillRect(0,e,g(),T),t.strokeStyle=d.roadLine,t.lineWidth=2*c,t.setLineDash([24*h,12*h]),t.lineDashOffset=-(performance.now()*.001*b),t.beginPath(),t.moveTo(0,e+T/2),t.lineTo(g(),e+T/2),t.stroke(),t.setLineDash([])}function me(e){A-=e,A<=0&&(Math.random()<.3?Le():we(),A=1400/Math.sqrt(w))}function we(){const e=o.h*.5,n=70*h;y.push({type:"car",x:g()+50,y:L(),w:n,h:e})}function Le(){const n=20*c,a=90*h,i=n*.8,s=o.h*.5*.6*.9,p=L()-s,v=10*c;let R=p-v-n;for(let B=0;B<6;B++)y.push({type:"plane",x:g()+50,y:R,w:a,h:n}),R-=n+i}function Ee(e){const n=e/16.67,a=.04;f.right?u=Math.min(1.25,u+a*n):f.left?u=Math.max(.75,u-a*n):u+=(1-u)*.1*n,o.grounded||(o.vy=Math.min(o.vy+le*n,ce),o.y+=o.vy*n,o.y>=L()&&(o.y=L(),o.vy=0,o.grounded=!0,z(o.x()+o.w/2,o.y+o.h,10,"#fff",1,3))),o.duckLerp+=((o.ducking?1:0)-o.duckLerp)*.2*n,b=Y*h*w*u;for(let l=y.length-1;l>=0;l--){const s=y[l];s.x-=b*n,s.x+s.w<-50&&y.splice(l,1)}const i=o.hitbox();for(const l of y)if(i.x<l.x+l.w&&i.x+i.w>l.x&&i.y<l.y+l.h&&i.y+i.h>l.y){Se();return}w+=1e-4*n}function Se(){if(E==="gameover")return;E="gameover",fe.textContent=Math.floor(x),de.classList.add("visible"),z(o.x()+o.w/2,o.y,50,d.neonGreen,3,8);let e=3;G.textContent=`Returning home in ${e}...`;const n=setInterval(()=>{e--,e>0?G.textContent=`Returning home in ${e}...`:(G.textContent="Returning home...",clearInterval(n),window.location.href="/")},1e3)}function Te(){x=0,w=1,b=Y*h,y=[],S=[],o.y=L(),o.vy=0,o.grounded=!0,o.ducking=!1,o.duckLerp=0,A=1e3,f.left=!1,f.right=!1,u=1}function ve(){Te(),E="playing",N()}function K(){o.grounded&&(o.vy=ae,o.grounded=!1,o.ducking=!1)}function J(){!o.grounded&&o.vy<0&&(o.vy*=se)}function q(e,n){if(E==="playing")switch(n.code){case"ArrowUp":case"Space":case"KeyW":e?K():J(),n.preventDefault();break;case"ArrowDown":case"KeyS":o.ducking=e&&o.grounded,n.preventDefault();break;case"ArrowLeft":case"KeyA":f.left=e,n.preventDefault();break;case"ArrowRight":case"KeyD":f.right=e,n.preventDefault();break}}function xe(){F(),o.y=L();for(let l=0;l<90;l++)U.stars.push({x:Math.random()*g(),y:Math.random()*_()*.6,s:Math.random()*2+1});document.addEventListener("keydown",l=>q(!0,l)),document.addEventListener("keyup",l=>q(!1,l));const e=document.getElementById("btn-up"),n=document.getElementById("btn-dn"),a=document.getElementById("btn-left"),i=document.getElementById("btn-right");e.addEventListener("pointerdown",K),e.addEventListener("pointerup",J),n.addEventListener("pointerdown",()=>{o.grounded&&(o.ducking=!0)}),n.addEventListener("pointerup",()=>o.ducking=!1),a.addEventListener("pointerdown",()=>f.left=!0),a.addEventListener("pointerup",()=>f.left=!1),i.addEventListener("pointerdown",()=>f.right=!0),i.addEventListener("pointerup",()=>f.right=!1),ve()}let I=0;function N(e=0){if(E!=="playing"){requestAnimationFrame(N);return}I===0&&(I=e);const n=e-I;I=e,n>0&&(me(n),Ee(n),x+=n/1e3*10*w*w*u),re.textContent=String(Math.floor(x)),ge(),pe();for(const a of y)ye(a);ue(o.duckLerp),he(),requestAnimationFrame(N)}xe()})();
