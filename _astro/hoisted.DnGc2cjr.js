const ae=document.getElementById("theme-toggle"),le=t=>{t==="light"?document.documentElement.classList.add("light-theme"):document.documentElement.classList.remove("light-theme")};ae.addEventListener("click",()=>{const I=document.documentElement.classList.contains("light-theme")?"dark":"light";le(I),localStorage.setItem("theme",I);const _=new CustomEvent("theme-change",{detail:{theme:I}});document.dispatchEvent(_)});const se=document.getElementById("city-toggle"),ce=t=>{t==="on"?document.documentElement.classList.add("city-mode-on"):document.documentElement.classList.remove("city-mode-on")};se.addEventListener("click",()=>{const I=document.documentElement.classList.contains("city-mode-on")?"off":"on";ce(I),localStorage.setItem("cityMode",I);const _=new CustomEvent("city-mode-change",{detail:{mode:I}});document.dispatchEvent(_)});const l=document.getElementById("scrolling-background");if(l){const t=l.getContext("2d");let I=[],_={cx:0,cy:0,r:0},ft=0,m=[],J=Math.random()<.5,K=[],V=[],ct=[],Y=[],it=[],at=[],lt=0,P=document.documentElement.classList.contains("light-theme"),Q=document.documentElement.classList.contains("city-mode-on");const W=120,X=40,Z=.2,rt=1,_t=[240,270,300,320,340],mt=[380,420,450,480,520],bt=Math.max(...mt),Ct=.04,It=.002,vt=.016,At=.0015,q=-10,Rt=.22,Pt=12,Lt=.18,Ft=24,gt=3.5,ut=58,kt=74,yt=22,Ot=12,Mt=6.5,Ht=Z*8,Bt=2,Gt=.9;let i={};try{const e=localStorage.getItem("theme"),o=localStorage.getItem("cityMode");e==="light"&&document.documentElement.classList.add("light-theme"),o==="on"&&document.documentElement.classList.add("city-mode-on")}catch{}P=document.documentElement.classList.contains("light-theme"),Q=document.documentElement.classList.contains("city-mode-on");const wt=()=>{P?i={sky:"#f0f0f0",building:"#d0d0d0",buildingDark:"#b0b0b0",window:"#ffffff",windowGlow:"#e0e0e0",road:"#a0a0a0",roadLine:"#ffffff",star:"#666666",smoke:"#c0c0c0",fire1:"#ff4444",fire2:"#ff8800",fire3:"#ffaa00",mountainFront:"#b4b4b4",mountainMid:"#c4c4c4",mountainFar:"#d4d4d4",sunMoonFill:"#f6c447",sunMoonCore:"#ffd772",stringWire:"#6e6e6e",bulbOutline:"#8a8a8a",bulbYellow:"#ffd84d",bulbGreen:"#7cff7a",tire:"#222",rim:"#888",headlight:"#ffe36a",neonPink:"#ff37a6",neonBlue:"#5ae0ff",neonGreen:"#78ff8a"}:i={sky:"#0a0b0f",building:"#1a1d29",buildingDark:"#141620",window:"#5ae0ff",windowGlow:"#ff37a6",road:"#232838",roadLine:"#5ae0ff",star:"#5ae0ff",smoke:"#ff37a6",fire1:"#ff4444",fire2:"#ff8800",fire3:"#ffaa00",mountainFront:"#151826",mountainMid:"#191c2c",mountainFar:"#1d2133",sunMoonFill:"#bfc7dc",sunMoonCore:"#e6ecff",stringWire:"#2a2f40",bulbOutline:"#8a8a8a",bulbYellow:"#ffd84d",bulbGreen:"#7cff7a",tire:"#111",rim:"#aaa",headlight:"#ffe36a",neonPink:"#ff37a6",neonBlue:"#5ae0ff",neonGreen:"#78ff8a"}},Nt=()=>{const e=l.height,o=l.width,a=.6,s=.7,x=.8,u=.9,y=.88,c=.86,n=1.1,M=0,r=-.1,E=.03,H=-.02,d=0,g=.65,v=.72,A=.88,R=[[-.05,.92],[.12,.66],[.27,.99],[.43,.48],[.58,.7],[.73,.58],[.88,.88],[1.05,.35]],N=[[-.3,.6],[-.1,.6],[.25,.86],[.32,.68],[.58,.72],[.72,.67],[.86,.73],[1.05,.7]],S=[[-.2,.5],[0,.72],[.26,.66],[.39,.67],[.51,.72],[.64,.65],[.76,.68],[.88,.56],[.98,.7],[1.05,.69]],L=7,w=(T,f)=>T.map(([h,k])=>[h,k*f]),p=(T,f,h)=>T.map(([k,dt])=>[f+(k-f)*h,dt]),b=(T,f)=>T.map(([h,k])=>[h+f,k]),F=(T,f)=>T.map(([h,k])=>[.5+(h-.5)*f,k]),C=T=>{const f=new Path2D;f.moveTo(T[0][0]*o,T[0][1]*e);for(let h=1;h<T.length;h++)f.lineTo(T[h][0]*o,T[h][1]*e);return f.lineTo(o,e),f.lineTo(0,e),f.closePath(),f};let O=F(b(p(w(R,a),g,u),M),n),B=F(b(p(w(N,s),v,y),r),n),D=F(b(p(w(N,s),v,y),E),n),z=F(b(p(w(S,x),A,c),H),n),G=F(b(p(w(S,x),A,c),d),n);ft=Math.min(...[O,B,D,z,G].flat().map(T=>T[1]))*e;const tt=24,et=e-X-bt,U=G[L][1];if(U*e>et-tt){const T=(et-tt)/e,f=U-T,h=k=>k.map(([dt,ie])=>[dt,ie-f]);O=h(O),B=h(B),D=h(D),z=h(z),G=h(G)}I=[C(O),C(B),C(D),C(z),C(G)];const st=G[L][1]*e,nt=25e-5*e;_={cx:o*.88,cy:st+nt,r:Math.min(o,e)*.07}},ht=()=>{l.width=window.innerWidth,l.height=window.innerHeight,Nt(),St(),Xt()},Dt=e=>{const o=e?mt:_t;return o[Math.random()*o.length|0]},Tt=e=>{const o=Dt(J),a={x:e,y:l.height-o-X+q,width:W,height:o,windows:Wt(W,o),fires:[],isTall:J};return J=!J,a},St=()=>{m=[];const e=-rt*W,o=Math.ceil(l.width/W)+rt*2+1;J=Math.random()<.5;for(let a=0;a<o;a++){const s=e+a*W;m.push(Tt(s))}},Wt=(e,o)=>{const a=[],u=Math.floor((e-20)/20),y=Math.floor((o-40)/20);for(let c=0;c<y;c++)for(let n=0;n<u;n++)Math.random()>.3&&a.push({x:10+n*20,y:20+c*20,size:12,glow:Math.random()>.8,onFire:!1});return a},zt=e=>{t.fillStyle=i.building,t.fillRect(e.x,e.y,e.width,e.height),t.fillStyle=i.buildingDark,t.fillRect(e.x+e.width-5,e.y,5,e.height),e.windows.forEach(o=>{if(o.onFire){t.fillStyle=i.window,t.shadowColor=i.fire1,t.shadowBlur=15;const a=e.x+o.x+o.size/2,s=e.y+o.y+o.size/2;oe(a,s,Math.max(6,o.size*.7));for(let x=0;x<2;x++)V.push({x:a+(Math.random()-.5)*4,y:s+(Math.random()-.5)*2,vx:(Math.random()-.5)*.8,vy:-(1.2+Math.random()*.8),life:1,size:4+Math.random()*6})}else o.glow?(t.fillStyle=i.windowGlow,t.shadowColor=i.windowGlow,t.shadowBlur=10):(t.fillStyle=i.window,t.shadowBlur=0);t.fillRect(e.x+o.x,e.y+o.y,o.size,o.size)}),t.shadowBlur=0},Xt=()=>{K=[];const e=100;for(let o=0;o<e;o++)K.push({x:Math.random()*l.width,y:Math.random()*(l.height*.6+q),size:Math.random()*2+1,twinkle:Math.random()*Math.PI*2})},Yt=()=>{if(!P&&Math.random()<It){const e=ut+Math.random()*(kt-ut),o=Math.random()<Gt;Y.push({x:-80,y:l.height-X-(yt+Mt)+q,width:e,height:yt,speed:Ht+Math.random()*Bt,cabH:Ot,wheelR:Mt,isGreen:o,clickCool:0,found:!1})}},Ut=e=>{const o=(e.height||22)*.5,a=e.width*.2,s=e.width*.02,x=o*.9,u=e.width*.47,y=e.width*.28,c=e.width*.1,n=e.width*.08,M=o*1.1,r=e.width*.18,E=e.width*.05,H=e.width*.05,d=e.x,g=e.width,v=e.wheelR||6.5,A=l.height-X+q,R=o,N=A,S=N-R,L=t.createLinearGradient(d,S,d,S+R);e.isGreen?(L.addColorStop(0,"#47ff7a"),L.addColorStop(1,"#20c85b")):(L.addColorStop(0,i.neonPink),L.addColorStop(1,i.neonBlue));const w=d+g*.5,p=A-2,b=t.createRadialGradient(w,p,2,w,p,g*.6);b.addColorStop(0,e.isGreen?i.neonGreen:i.neonPink),b.addColorStop(1,"rgba(0,0,0,0)"),t.save(),t.globalAlpha=.35,t.beginPath(),t.ellipse(w,p,g*.45,10,0,0,Math.PI*2),t.fillStyle=b,t.fill(),t.restore(),t.fillStyle=i.tire,t.beginPath(),t.arc(d+g*.24,A,v,0,Math.PI*2),t.arc(d+g*.76,A,v,0,Math.PI*2),t.fill(),t.fillStyle=i.rim,t.beginPath(),t.arc(d+g*.24,A,v*.4,0,Math.PI*2),t.arc(d+g*.76,A,v*.4,0,Math.PI*2),t.fill();const F=s,C=a;t.beginPath(),t.moveTo(d,N),t.lineTo(d+g,N),t.lineTo(d+g-C,S),t.lineTo(d+F,S),t.closePath(),t.fillStyle=L,t.fill(),t.strokeStyle="rgba(0,0,0,0.25)",t.lineWidth=1,t.stroke();const O=S-x,B=d+y,D=B+u,z=B+c,G=D-n;t.beginPath(),t.moveTo(B,S),t.lineTo(z,O),t.lineTo(G,O),t.lineTo(D,S),t.fillStyle=L,t.fill(),t.strokeStyle="rgba(230,236,255,0.6)",t.lineWidth=1.5,t.beginPath(),t.moveTo(z+3,O+2),t.lineTo(G-3,O+2),t.stroke();const $=d+H;t.beginPath(),t.moveTo($,S),t.lineTo($-E,S-M),t.lineTo($-E-r,S-M),t.lineTo($-r,S),t.closePath(),t.fillStyle=L,t.fill(),t.stroke();const tt=Math.max(6,R*.35),et=Math.max(5,R*.25),U=d+g-C-2,ot=S+2;t.fillStyle=i.headlight,t.save();const st=5;t.beginPath(),t.moveTo(U,ot),t.lineTo(U+tt,ot),t.lineTo(U+tt-st,ot+et),t.lineTo(U-st,ot+et),t.closePath(),t.fill(),t.restore();const nt=120,T=28,f=d+g-C+1,h=S+R*.18,k=t.createLinearGradient(f,h,f+nt,h);k.addColorStop(0,i.headlight),k.addColorStop(1,"rgba(255,227,106,0)"),t.save(),t.globalAlpha=.35,t.beginPath(),t.moveTo(f,h),t.lineTo(f+nt,h-T*.5),t.lineTo(f+nt,h+T*.5),t.closePath(),t.fillStyle=k,t.fill(),t.restore()},Kt=(e,o,a)=>{const u=e.x+e.width-8,y=e.y+6,c=a.x+8,n=a.y+6,M=c-u;if(Math.abs(M)<=12)return;const r=Math.abs(M),E=Math.max(Pt,r*Rt),H=u+M*.25,d=c-M*.25,g=(n-y)*Lt,v=Math.max(y,n),A=v+E*.55+g,R=v+E*.55-g;t.save(),t.strokeStyle=i.stringWire,t.lineWidth=2,t.beginPath(),t.moveTo(u,y),t.bezierCurveTo(H,A,d,R,c,n),t.stroke(),t.restore();const N=w=>{const p=1-w,b=p*p,F=w*w,C=b*p,O=3*b*w,B=3*p*F,D=w*F,z=C*u+O*H+B*d+D*c,G=C*y+O*A+B*R+D*n;return{x:z,y:G}},S=Math.hypot(M,(A+R)*.5-(y+n)*.5)+E,L=Math.max(6,Math.floor(S/Ft));for(let w=1;w<=L;w++){const p=w/(L+1),{x:b,y:F}=N(p);if(P)t.save(),t.shadowBlur=0,t.lineWidth=1.6,t.strokeStyle=i.bulbOutline||i.stringWire,t.beginPath(),t.arc(b,F,gt,0,Math.PI*2),t.stroke(),t.restore();else{const C=w%2===0?i.bulbYellow:i.bulbGreen;t.save(),t.fillStyle=C,t.shadowColor=C,t.shadowBlur=10,t.beginPath(),t.arc(b,F,gt,0,Math.PI*2),t.fill(),t.restore()}}},Qt=()=>{for(let e=1;e<m.length-1;e++){const o=m[e-1],a=m[e],s=m[e+1];o.height>a.height&&s.height>a.height&&Kt(o,a,s)}},Zt=()=>{const e=l.height-X+q;t.fillStyle=i.road,t.fillRect(0,e,l.width,X),t.strokeStyle=i.roadLine,t.lineWidth=2,t.setLineDash([20,10]),t.lineDashOffset=lt,t.beginPath(),t.moveTo(0,e+X/2),t.lineTo(l.width,e+X/2),t.stroke(),t.setLineDash([])},qt=()=>{P||(K.forEach(e=>{const o=Math.sin(e.twinkle+Date.now()*.001)*.5+.5;t.fillStyle=i.star,t.globalAlpha=o*.8+.2,t.fillRect(e.x,e.y,e.size,e.size)}),t.globalAlpha=1)},Jt=()=>{if(P){it=[];return}if(Math.random()<vt){const e=Math.random()*l.width,o=-20,a=3+Math.random()*3.5,s=(Math.random()-.5)*5;it.push({x:e,y:o,vx:s,vy:a,len:80+Math.random()*60,life:1})}it=it.filter(e=>{e.x+=e.vx,e.y+=e.vy,e.len*=.985,e.life-=.004;const o=Math.hypot(e.vx,e.vy)||1;{const a=e.x-e.vx/o*e.len,s=e.y-e.vy/o*e.len;t.save(),t.globalAlpha=Math.max(0,Math.min(1,e.life)),t.strokeStyle=i.star,t.lineWidth=2,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(a,s),t.stroke(),t.restore()}return e.life>0&&e.y<l.height+120&&e.x>-120&&e.x<l.width+120})},Vt=()=>{if(!P){at=[];return}const e=24,o=.06*l.height,a=(_.cy||0)-(_.r||0)-e,s=(ft||l.height*.55)-e,x=Math.max(o+20,Math.min(a,s)),u=o,y=Number.isFinite(x)&&x>u+10?x:l.height*.22;if(Math.random()<At){const n=Math.random()<.5,M=(n?1:-1)*(1+Math.random()*1.2),r=u+Math.random()*(y-u),E=8+Math.floor(Math.random()*8),H=1+Math.random()*.6,d=[];for(let g=0;g<E;g++){const v=Math.floor(g/2),R=(14*H+v*3)*(n?1:-1)*v,N=(g%2===0?-1:1)*(5+v)*(.6*H);d.push({x:n?-80-R:l.width+80-R,y:r+N,phase:Math.random()*Math.PI*2,s:6*H})}at.push({birds:d,vx:M,amp:2.5*H})}t.save(),t.strokeStyle="#333",t.lineWidth=2;const c=performance.now()*.012;at=at.filter(n=>{let M=!1;for(const r of n.birds){r.x+=n.vx;const E=Math.sin(c+r.phase)*n.amp;t.beginPath(),t.moveTo(r.x-r.s,r.y-E),t.lineTo(r.x,r.y),t.lineTo(r.x+r.s,r.y-E),t.stroke(),r.x>-100&&r.x<l.width+100&&(M=!0)}return M}),t.restore()},jt=()=>{const e=t.createRadialGradient(_.cx,_.cy,0,_.cx,_.cy,_.r);e.addColorStop(0,i.sunMoonCore),e.addColorStop(1,i.sunMoonFill),t.fillStyle=e,t.beginPath(),t.arc(_.cx,_.cy,_.r,0,Math.PI*2),t.fill(),t.fillStyle=i.mountainFar,t.fill(I[0]),t.fillStyle=i.mountainMid,t.fill(I[1]),t.fillStyle=i.mountainMid,t.fill(I[2]),t.fillStyle=i.mountainFront,t.fill(I[3]),t.fillStyle=i.mountainFront,t.fill(I[4])},$t=()=>{P&&(ct=ct.filter(e=>{if(e.x+=e.vx+Z,e.y+=e.vy,e.life-=.02,e.vy-=.05,e.vx+=(Math.random()-.5)*.1,e.life>0){const o=[i.fire1,i.fire2,i.fire3],a=Math.floor((1-e.life)*o.length);return t.fillStyle=o[Math.min(a,o.length-1)],t.globalAlpha=e.life,t.fillRect(e.x,e.y,e.size,e.size),!0}return!1}),t.globalAlpha=1)},te=()=>{if(Math.random()<.1&&m.length>0){const e=m[Math.floor(Math.random()*m.length)];V.push({x:e.x+e.width/2+(Math.random()-.5)*20,y:e.y,vx:(Math.random()-.5)*.5,vy:-Math.random()*2-1,life:1,size:Math.random()*8+4})}V=V.filter(e=>(e.x+=e.vx+Z,e.y+=e.vy,e.life-=.01,e.vy*=.99,e.life>0?(t.fillStyle=i.smoke,t.globalAlpha=e.life*.3,t.fillRect(e.x,e.y,e.size,e.size),!0):!1)),t.globalAlpha=1},ee=e=>{const o=l.getBoundingClientRect(),a="changedTouches"in e&&e.changedTouches?.[0]?e.changedTouches[0]:e,s=l.width/o.width,x=l.height/o.height,u=(a.clientX-o.left)*s,y=(a.clientY-o.top)*x;if(!P)for(let c=0;c<Y.length;c++){const n=Y[c];if(u>=n.x&&u<=n.x+n.width&&y>=n.y-n.cabH&&y<=n.y+n.height+n.wheelR+6){if(n.isGreen){if(!n.found&&n.clickCool<=0){window.location.href="/green-car-runner";return}}else n.speed+=2,n.clickCool=10;return}}if(P)for(let c of m)for(let n of c.windows){const M=c.x+n.x,r=c.y+n.y;if(u>=M&&u<=M+n.size&&y>=r&&y<=r+n.size&&!n.onFire){n.onFire=!0,n.burnStarted=performance.now();for(let E=0;E<20;E++)ct.push({x:M+n.size/2+(Math.random()-.5)*8,y:r+n.size/2+(Math.random()-.5)*8,vx:(Math.random()-.5)*1.5,vy:-Math.random()*2.5-.5,life:1,size:Math.random()*4+2});return}}for(let c=0;c<15;c++)V.push({x:u+(Math.random()-.5)*30,y:y+(Math.random()-.5)*30,vx:(Math.random()-.5)*3,vy:(Math.random()-.5)*3,life:1,size:Math.random()*8+4})};let j;const xt=()=>{for(t.fillStyle=i.sky,t.fillRect(0,0,l.width,l.height),qt(),Jt(),jt(),Vt(),lt+=Z*20,lt>30&&(lt=0),Yt(),m.forEach(e=>e.x-=Z);m.length&&m[0].x+W<-120;)m.shift();for(;m.length&&m[m.length-1].x+W<l.width+rt*W;){const e=m[m.length-1];m.push(Tt(e.x+W))}Y=Y.filter(e=>(e.x+=e.speed,e.clickCool>0&&e.clickCool--,e.x<l.width+200)),m.forEach(zt),Qt(),Zt(),Y.forEach(Ut),te(),$t(),!P&&Math.random()<Ct&&K.push({x:l.width,y:Math.random()*(l.height*.6+q),size:Math.random()*2+1,twinkle:Math.random()*Math.PI*2}),K=K.filter(e=>(e.x-=Z*.5,e.twinkle+=.02,e.x>-10)),j=requestAnimationFrame(xt)},oe=(e,o,a)=>{const s=t.createRadialGradient(e,o,0,e,o,a);s.addColorStop(0,"#ffff66"),s.addColorStop(.4,"#ff9900"),s.addColorStop(1,"#ff3300"),t.fillStyle=s;const x=(Math.random()-.5)*2;t.beginPath(),t.ellipse(e,o-a*.2,a*.6,a*(.9+x*.05),0,0,Math.PI*2),t.fill()},Et=()=>{j&&cancelAnimationFrame(j),wt(),ht(),xt()},ne=()=>{j&&cancelAnimationFrame(j)};window.addEventListener("resize",ht),l.style.pointerEvents="none";const pt=e=>{Q&&(e.target.closest("#theme-toggle, #city-toggle, nav, a, button, input, textarea, select")||ee(e))};document.addEventListener("click",pt,!0),document.addEventListener("touchend",pt,!0),document.addEventListener("city-mode-change",e=>{Q=e.detail.mode==="on",Q?Et():ne()}),document.addEventListener("theme-change",()=>{P=document.documentElement.classList.contains("light-theme"),Q&&(wt(),St(),ht(),P&&(Y=[]))}),Q&&Et()}
